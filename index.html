<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroVetor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <style>
        :root {
            --color-primary: #4CAF50;
            --color-primary-light: #81C784;
            --color-primary-dark: #388E3C;
            --color-accent: #FFC107;
            --color-background: #f4f6f9;
            --color-surface: #FFFFFF;
            --color-text: #333333;
            --color-text-light: #757575;
            --color-border: #e0e0e0;
            --color-danger: #D32F2F;
            --color-warning: #F57C00;
            --color-info: #1976D2;
            --color-success: #388E3C;
            --color-purple: #7B1FA2;
            --shadow-light: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-medium: 0 4px 8px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }
        .theme-dark {
            --color-primary: #66bb6a;
            --color-primary-light: #81C784;
            --color-primary-dark: #388E3C;
            --color-accent: #FFC107;
            --color-background: #121212;
            --color-surface: #1e1e1e;
            --color-text: #e0e0e0;
            --color-text-light: #bdbdbd;
            --color-border: #424242;
        }
        .theme-blue {
            --color-primary: #2196F3;
            --color-primary-light: #64B5F6;
            --color-primary-dark: #1976D2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--color-background); color: var(--color-text); transition: background-color 0.3s, color 0.3s; }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 10000; flex-direction: column; color: white; }
        .spinner { border: 4px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 4px solid #fff; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #loading-progress-text { margin-top: 20px; font-size: 1.1em; }

        #loginScreen { display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(to bottom right, var(--color-primary-dark), var(--color-primary)); }
        #loginBox { background-color: var(--color-surface); padding: 40px; border-radius: var(--border-radius); box-shadow: var(--shadow-medium); text-align: center; width: 90%; max-width: 400px; }
        #loginBox h2 { margin-bottom: 20px; color: var(--color-primary); }
        .input-group { margin-bottom: 20px; position: relative; }
        .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--color-text-light); }
        .input-group input { width: 100%; padding: 12px 12px 12px 45px; border: 1px solid var(--color-border); border-radius: var(--border-radius); background-color: var(--color-background); color: var(--color-text); }
        #btnLogin, .btn { width: 100%; padding: 12px; background-color: var(--color-primary); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-size: 1em; font-weight: 600; transition: background-color 0.3s; }
        #btnLogin:hover { background-color: var(--color-primary-dark); }
        #loginMessage { margin-top: 15px; color: var(--color-danger); font-weight: 500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        header { background-color: var(--color-surface); color: var(--color-text); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: var(--shadow-light); position: fixed; top: 0; left: 0; right: 0; z-index: 1000; height: 60px; }
        #appScreen { display: none; flex-direction: column; height: 100vh; }
        #btnToggleMenu { background: none; border: none; font-size: 1.5em; cursor: pointer; color: var(--color-text); }
        header h1 { font-size: 1.2em; font-weight: 600; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        #header-right { display: flex; align-items: center; gap: 20px; }
        #currentDateTime { font-size: 0.9em; color: var(--color-text-light); }
        #logoutBtn { background: none; border: none; font-size: 1.2em; cursor: pointer; color: var(--color-danger); }
        #main-container { display: flex; margin-top: 60px; height: calc(100vh - 60px); }
        #menu { background-color: var(--color-surface); width: 250px; padding-top: 20px; box-shadow: var(--shadow-light); transition: transform 0.3s ease-in-out; transform: translateX(0); z-index: 999; }
        .menu-btn, .submenu-btn, .submenu-back-btn { display: flex; align-items: center; gap: 15px; width: 100%; padding: 15px 20px; background: none; border: none; text-align: left; font-size: 1em; cursor: pointer; color: var(--color-text); transition: background-color 0.2s, color 0.2s; }
        .menu-btn:hover, .submenu-btn:hover, .submenu-back-btn:hover { background-color: var(--color-background); color: var(--color-primary); }
        .menu-btn i, .submenu-btn i, .submenu-back-btn i { width: 20px; text-align: center; }
        #content { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .chart-card { background-color: var(--color-surface); padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow-light); }
        .chart-card.main-chart { grid-column: 1 / -1; }
        .chart-title { font-size: 1.1em; font-weight: 600; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .chart-container { position: relative; height: 300px; }
        .dashboard-tabs { display: flex; gap: 10px; margin-bottom: 20px; background-color: var(--color-surface); padding: 5px; border-radius: var(--border-radius); box-shadow: var(--shadow-light); }
        .dashboard-tab-btn { flex-grow: 1; padding: 10px 15px; background-color: transparent; border: none; border-radius: 6px; font-size: 1em; font-weight: 500; cursor: pointer; transition: all 0.3s ease; color: var(--color-text-light); }
        .dashboard-tab-btn:hover { background-color: var(--color-background); color: var(--color-text); }
        .dashboard-tab-btn.active { background-color: var(--color-primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .kpi-card { background-color: var(--color-surface); display: flex; align-items: center; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow-light); border-left: 5px solid; }
        .kpi-card .icon { font-size: 2em; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 20px; }
        .kpi-card .text .value { font-size: 1.8em; font-weight: 700; }
        .kpi-card .text .label { font-size: 1em; color: var(--color-text-light); }
        @media (max-width: 768px) { #menu { position: fixed; top: 60px; left: 0; bottom: 0; transform: translateX(-100%); } body.mobile-menu-open #menu { transform: translateX(0); } }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-progress-text">A carregar...</p>
    </div>

    <div id="loginScreen">
        <div id="loginBox">
            <h2><i class="fa-solid fa-leaf"></i> AgroVetor</h2>
            <div id="loginForm">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="loginUser" placeholder="Utilizador">
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="loginPass" placeholder="Palavra-passe">
                </div>
                <button id="btnLogin">Entrar</button>
                <p id="loginMessage"></p>
            </div>
            <div id="offlineUserSelection" style="display: none;">
                <h3>Aceder Offline</h3>
                <div id="offlineUserList"></div>
            </div>
        </div>
    </div>

    <div id="appScreen">
        <header>
            <button id="btnToggleMenu"><i class="fas fa-bars"></i></button>
            <h1><i class="fa-solid fa-leaf"></i> AgroVetor</h1>
            <div id="header-right">
                <div id="currentDateTime"></div>
                <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>

        <div id="main-container">
            <nav id="menu">
                <!-- O conteúdo do menu será gerado pelo app.js -->
            </nav>
            <main id="content">
                <div id="dashboard" class="tab-content active">
                    <div class="dashboard-tabs">
                        <button id="btn-dash-broca" class="dashboard-tab-btn active"><i class="fas fa-bug"></i> Broca</button>
                        <button id="btn-dash-perda" class="dashboard-tab-btn"><i class="fas fa-dollar-sign"></i> Perdas</button>
                        <button id="btn-dash-aerea" class="dashboard-tab-btn"><i class="fas fa-plane"></i> Aplicação Aérea</button>
                    </div>

                    <div id="dashboard-broca">
                        <div class="kpi-grid" id="kpi-grid-broca"></div>
                        <div class="dashboard-grid">
                            <div class="chart-card main-chart">
                                <div class="chart-title">Top 10 Fazendas com Maior Incidência de Broca</div>
                                <div class="chart-container"><canvas id="graficoTop10FazendasBroca"></canvas></div>
                            </div>
                            <div class="chart-card">
                                <div class="chart-title">Índice Mensal de Broca (%)</div>
                                <div class="chart-container"><canvas id="graficoBrocaMensal"></canvas></div>
                            </div>
                            <div class="chart-card">
                                <div class="chart-title">Posição da Broca na Cana</div>
                                <div class="chart-container"><canvas id="graficoBrocaPosicao"></canvas></div>
                            </div>
                            <div class="chart-card">
                                <div class="chart-title">Incidência por Variedade</div>
                                <div class="chart-container"><canvas id="graficoBrocaPorVariedade"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <div id="dashboard-perda" style="display: none;">
                        <div class="kpi-grid" id="kpi-grid-perda"></div>
                        <div class="dashboard-grid">
                            <div class="chart-card main-chart">
                                <div class="chart-title">Perda Média por Frente e Turno (kg)</div>
                                <div class="chart-container"><canvas id="graficoPerdaPorFrenteTurno"></canvas></div>
                            </div>
                            <div class="chart-card">
                                <div class="chart-title">Composição da Perda Total por Frente (kg)</div>
                                <div class="chart-container"><canvas id="graficoComposicaoPerda"></canvas></div>
                            </div>
                            <div class="chart-card">
                                <div class="chart-title">Top 10 Fazendas com Maiores Perdas</div>
                                <div class="chart-container"><canvas id="graficoTop10FazendasPerda"></canvas></div>
                            </div>
                             <div class="chart-card">
                                <div class="chart-title">Perda Média por Frente (kg)</div>
                                <div class="chart-container"><canvas id="graficoPerdaPorFrente"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <div id="dashboard-aerea" style="display: none;">
                        <h2>Dashboard Aéreo</h2>
                        <p>Conteúdo do dashboard aéreo...</p>
                    </div>
                </div>
                
                <div id="lancamentoBroca" class="tab-content">
                    <h2>Lançamento de Brocamento</h2>
                    <!-- Conteúdo do formulário de broca aqui -->
                </div>
                <div id="lancamentoPerda" class="tab-content">
                    <h2>Lançamento de Perda</h2>
                    <!-- Conteúdo do formulário de perda aqui -->
                </div>
                <!-- Outros .tab-content aqui -->
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.1.0"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
